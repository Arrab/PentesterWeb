<?php
    require_once("configuracion.php");
    $mensaje=false;
    if(isset($_POST["alta"])) {
        $user = $_POST["user"];
        $pass = $_POST["pass"];
        $consultaBD = "INSERT INTO tablausuarios (user,pass) VALUES ('$user','$pass')";
        mysql_query($consultaBD,$identificadorBD) or die("Error: ".mysql_error());
        $mensaje="¡Registrado correctamente!";
    }
    elseif(isset($_POST["entrar"])) {
        $user = $_POST["user"];
        $pass = $_POST["pass"];
        $consultaBD = "SELECT id FROM tablausuarios WHERE user='$user' AND pass='$pass'";
        $recursoBD  = mysql_query($consultaBD,$identificadorBD) or die("Error: ".mysql_error());
        if(mysql_fetch_assoc($recursoBD)) {
            session_start();
            $_SESSION["user"] = $user;
            header("Location: web.php");
        }
        else {
            $mensaje="¡Usuario no registrado!";
        }
    }
?>

<!DOCTYPE html>

<html>
    
<head>
    <meta charset="UTF-8">
    <title>Seguridad en Aplicaciones Web</title>
    <link href="css/estilos.css" rel="stylesheet" type="text/css" media="screen"/>
</head>

<body>
    <div id="contenedor">
        <h1>Seguridad en AW</h1><hr/>
        <p>Por favor, introduzca los datos de acceso:</p>
        <form class="centrado" name="formulario" action="<?php echo($_SERVER["PHP_SELF"])?>" method="post">
            <div>
                <label for="user">Usuario</label>
                <input type="text" name="user" id="user" />
            </div>
            <div>
                <label for="pass">Contraseña</label>
                <input type="password" name="pass" id="pass" />
            </div>
            <p><span>&nbsp;<?php if($mensaje) echo $mensaje; ?>&nbsp;</span></p>
            <div class="centrado">
                <input type="submit" name="entrar" value="Entrar"/>
                <input type="submit" name="alta"   value="Alta"/>
            </div>
        </form>
    </div>
</body>

</html>